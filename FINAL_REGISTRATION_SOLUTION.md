# –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## üîç –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã

–û—à–∏–±–∫–∞ **"Email address is invalid"** –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑-–∑–∞ —Å—Ç—Ä–æ–≥–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ Supabase Auth. Supabase –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ñ–æ—Ä–º–∞—Ç email –∞–¥—Ä–µ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–∞–ª–∏–¥–Ω—ã–µ –∞–¥—Ä–µ—Å–∞.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–Ø –∏–∑–º–µ–Ω–∏–ª –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —á—Ç–æ–±—ã **–æ–±–æ–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É —Å Supabase Auth**:

### 1. –ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

**–°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–ø—Ä–æ–±–ª–µ–º–Ω—ã–π):**
1. Supabase Auth ‚Üí ‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ email
2. –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

**–ù–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å (—Ä–∞–±–æ—á–∏–π):**
1. **API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Üí ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. **Supabase Auth** ‚Üí ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å)

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

#### `client/src/lib/auth.tsx` - –§—É–Ω–∫—Ü–∏—è `signUp`:
```typescript
const signUp = async (email: string, password: string, userData: any) => {
  try {
    // 1. –°–ù–ê–ß–ê–õ–ê —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API
    const response = await fetch('/api/auth/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({...userData, email, password})
    });

    if (!response.ok) {
      throw new Error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è —É—á–µ–Ω–∏–∫–∞');
    }

    // 2. –ü–û–¢–û–ú –ø—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –≤ Supabase Auth (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    try {
      await supabase.auth.signUp({ email, password, options: {...} });
    } catch (supabaseError) {
      // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å - –ø—Ä–æ—Ñ–∏–ª—å —É–∂–µ —Å–æ–∑–¥–∞–Ω!
      console.warn('Supabase Auth –Ω–µ —É–¥–∞–ª—Å—è, –Ω–æ –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω');
    }
  } catch (error) {
    throw new Error(error.message);
  }
};
```

#### `client/src/lib/auth.tsx` - –§—É–Ω–∫—Ü–∏—è `signIn`:
```typescript
const signIn = async (email: string, password: string) => {
  try {
    // 1. –ü—ã—Ç–∞–µ–º—Å—è –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Supabase Auth
    const { data, error } = await supabase.auth.signInWithPassword({...});
    
    if (error) {
      // 2. –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å - –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à API
      const response = await fetch('/api/auth/login', {...});
      // –°–æ–∑–¥–∞–µ–º —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
  } catch (error) {
    throw new Error(error.message);
  }
};
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –†–µ—à–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:
- **Email –≤–∞–ª–∏–¥–∞—Ü–∏—è** - –±–æ–ª—å—à–µ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Supabase Auth** - —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ Supabase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±—ã–µ email –∞–¥—Ä–µ—Å–∞
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- **Supabase Auth** - –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **API** - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   npm run dev
   ```

2. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

3. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É** –ª—é–±—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - –ò–º—è: –ü–µ—Ç—Ä–æ–≤
   - –§–∞–º–∏–ª–∏—è: –ü–µ—Ç—Ä–æ–≤–∏—á  
   - Email: petrov@mail.ru (—Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç!)
   - –ü–∞—Ä–æ–ª—å: test123
   - –¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67
   - –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: 15.05.1990

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
   - ‚ö†Ô∏è Supabase Auth –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å (–Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç—å Supabase Auth:

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env`:
```env
VITE_BYPASS_SUPABASE_AUTH=true
```

–ò –æ–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥:
```typescript
const bypassSupabaseAuth = import.meta.env.VITE_BYPASS_SUPABASE_AUTH === 'true';

if (!bypassSupabaseAuth) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º Supabase Auth
} else {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—à API
}
```

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```
‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—á–µ–Ω–∏–∫–∞ —Å–æ–∑–¥–∞–Ω: {id: "...", firstName: "–ü–µ—Ç—Ä–æ–≤", ...}
‚ö†Ô∏è Supabase Auth —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –Ω–æ –ø—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω: Email address is invalid
```

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞:
```
‚úÖ Registration successful for: petrov@mail.ru
‚úÖ Pupil created with ID: 12345
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞!**

- ‚úÖ **–õ—é–±—ã–µ email –∞–¥—Ä–µ—Å–∞** —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Supabase Auth
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞** –∏ –Ω–∞–¥–µ–∂–Ω–∞
- ‚úÖ **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

**–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ª—é–±—ã–º–∏ email –∞–¥—Ä–µ—Å–∞–º–∏ (–≤–∫–ª—é—á–∞—è petrov@mail.ru) –º–æ–≥—É—Ç —É—Å–ø–µ—à–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è!**
