# Исправление ошибки удаления ученика

## Проблема

При попытке удалить ученика возникала ошибка 500:
```
Failed to load resource: the server responded with a status of 500 (Internal Server Error)
```

## Причина

1. **Недостаточное логирование** - ошибка не логировалась на сервере
2. **Тихий сбой** - функция `deletePupil` в `storage.ts` ловила все ошибки и возвращала `false` без логирования
3. **Неправильный статус** - сервер возвращал 400 вместо 500 при ошибке

## Решение

### 1. Добавлено логирование в server/storage.ts

```typescript
async deletePupil(id: string): Promise<boolean> {
  try {
    console.log('Deleting pupil with ID:', id);
    await db.pupil.delete({ where: { id } });
    console.log('Pupil deleted successfully');
    return true;
  } catch (error) {
    console.error('Error deleting pupil:', error);
    throw error; // Пробрасываем ошибку для логирования
  }
}
```

### 2. Улучшена обработка ошибок в server/routes.ts

```typescript
app.delete("/api/pupils/:id", async (req: ValidatedRequest, res) => {
  const context = createRequestContext(req);
  
  try {
    const { id } = req.params;
    logger.info('Deleting pupil attempt', context, { pupilId: id });
    
    const success = await storage.deletePupil(id);
    if (!success) {
      logger.warn('Pupil not found or delete failed', context, { pupilId: id });
      return res.status(404).json({ message: "Pupil not found" });
    }
    
    logger.info('Pupil deleted successfully', context, { pupilId: id });
    res.json({ success: true });
  } catch (error) {
    logger.error('Error deleting pupil', error as Error, context);
    throw ErrorHandler.handleUnexpectedError(error as Error, req);
  }
});
```

## Что изменилось

1. ✅ **Добавлено подробное логирование** - теперь все ошибки видны в логах сервера
2. ✅ **Проброс ошибок** - ошибки не "проглатываются", а пробрасываются для анализа
3. ✅ **Правильный статус** - используется 500 для серверных ошибок, 404 для "не найдено"
4. ✅ **Контекст запроса** - добавлен для лучшего трейсинга

## Проверка

После перезапуска сервера:

1. Откройте консоль сервера
2. Попробуйте удалить ученика
3. Проверьте логи:
   - Должно появиться: `Deleting pupil with ID: ...`
   - При успехе: `Pupil deleted successfully`
   - При ошибке: полный stack trace ошибки

## Следующие шаги

1. Применить изменения в git
2. Перезапустить сервер
3. Протестировать удаление ученика
4. Проверить логи на наличие ошибок

